NAME := reststrategy
VERSION := "v0.0.0"
REVISION := $(shell git rev-parse --short HEAD)

LDFLAGS := -ldflags="-s -w -X \"github.com/$(OWNER)/$(NAME)/seeder/cmd/strategyrestseeder.Version=$(VERSION)\" -X \"github.com/$(OWNER)/$(NAME)/seeder/cmd/strategyrestseeder.Revision=$(REVISION)\" -extldflags -static"

install:
	go mod tidy
	go mod vendor
	
codegen:
	./hack/update-codegen.sh

copygened: codegen
	echo "Copying Generated DeepCopyFunc" && cp -fr github.com/dnitsch/reststrategy/seeder/pkg/rest/* ./pkg/rest/ && \
	echo "rm -rf github.com" && rm -rf github.com
	echo "Types Updated"

codegen_verify:
	./hack/verify-codegen.sh

.PHONY: clean
clean:
	rm -rf bin/*
	rm -rf dist/*
	rm -rf vendor/*
	mkdir -p dist

bingen:
	for os in darwin linux windows; do \
	    [ $$os = "windows" ] && EXT=".exe"; \
		GOOS=$$os CGO_ENABLED=0 go build -a -tags netgo -installsuffix netgo $(LDFLAGS) -o dist/seeder-$$os$$EXT ./cmd; \
	done

build: clean install copygened bingen

build_ci: clean install copygened codegen_verify bingen